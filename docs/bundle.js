!function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,t,n){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=8)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var s=n(3),r=i(s),o=n(5),a=500,u=400,c=(0,o.createCanvas)(a,u);document.getElementById("app").appendChild(c);var l=new r.default({width:a,height:u,tilesetImage:"img/vase.png",ctx:c.getContext("2d")});l.on("paused",function(){}),l.on("unpaused",function(){}),l.on("ready",function(){}),(0,o.onHidden)(function(){return l.emit("pause")},function(){return l.emit("unpause")})},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(){n(this,e),this.img=null,this.tiles=new Map,this.tileIndex=[]}return i(e,[{key:"loadImage",value:function(e){var t=this;return new Promise(function(n,i){t.img=new Image,t.img.onload=function(){n(e)},t.img.onerror=function(){return i(e)},t.img.src=e})}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.tiles.set(e,Object.assign({},t)),this.tileIndex=Array.from(this.tiles.keys())}},{key:"getIndex",value:function(e){return this.tileIndex.indexOf(e)}},{key:"getKey",value:function(e){return this.tileIndex[e]}}]),e}();t.default=s},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(){n(this,e),this.ctx=new AudioContext;var t=this.ctx.createOscillator();t.type="sine",t.start(0);var i=this.ctx.createGain();i.gain.value=0,t.connect(i),i.connect(this.ctx.destination),this.osc=t,this.amp=i,this.activeNotes=[]}return i(e,[{key:"fetchSample",value:function(e){var t=this;return fetch(encodeURIComponent(e)).then(function(e){return e.arrayBuffer()}).then(function(e){return t.ctx.decodeAudioData(e)})}},{key:"playSample",value:function(e){var t=this.ctx.createBufferSource();t.buffer=e;var n=this.ctx.createGain();t.connect(n),n.connect(this.ctx.destination),n.gain.value=.3,t.start(0)}},{key:"playNote",value:function(e){this.osc.frequency.value=e,this.amp.gain.value=1,this.activeNotes.push(e),setTimeout(this.endNote.bind(this),300)}},{key:"endNote",value:function(){this.activeNotes.shift(),0===this.activeNotes.length&&(this.amp.gain.value=0)}}]),e}();t.default=s},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(4),c=i(u),l=n(1),h=i(l),f=n(6),p=i(f),d=n(2),v=i(d),y=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,i=e.height,o=e.ctx,a=e.tilesetImage;s(this,t);var u=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return u.width=n,u.height=i,u.ctx=o,u.leftDown=!1,u.rightDown=!1,u.upDown=!1,u.downDown=!1,u.setupControls(),u.time=0,u.fps=30,u.paused=!1,u.sound=new v.default,u.imagesLoaded=!1,u.tileatlas=new h.default,u.tileatlas.loadImage(a).then(function(){return u.loadImages()}).then(function(){return u.imagesLoaded=!0}).then(function(){return u.emit("loading:complete")}).catch(function(e){console.log("Error loading image",a),console.log(e)}),u.vase={x:n/2-16,y:i/2-16,tileset:u.tileatlas,key:"vase"},u.on("togglePause",u.togglePause.bind(u)),u.on("pause",u.pause.bind(u)),u.on("unpause",u.unpause.bind(u)),u.on("loading:complete",u.tick),u.emit("init:complete"),u}return o(t,e),a(t,[{key:"setupControls",value:function(){var e=this;c.default.bind("left",function(){e.leftDown=!0,e.rightDown=!1},"keydown"),c.default.bind("left",function(){e.leftDown=!1},"keyup"),c.default.bind("right",function(){e.rightDown=!0,e.leftDown=!1},"keydown"),c.default.bind("right",function(){e.rightDown=!1},"keyup"),c.default.bind("up",function(){e.upDown=!0,e.downDown=!1},"keydown"),c.default.bind("up",function(){e.upDown=!1},"keyup"),c.default.bind("down",function(){e.downDown=!0,e.upDown=!1},"keydown"),c.default.bind("down",function(){e.downDown=!1},"keyup"),c.default.bind("p",this.togglePause.bind(this));var t=this.ctx.canvas;t.addEventListener("touchstart",this.onTouchStart.bind(this),!1),t.addEventListener("touchmove",this.onTouchMove.bind(this),!1),t.addEventListener("touchend",this.onTouchEnd.bind(this),!1)}},{key:"onTouchStart",value:function(e){var t=this;e.preventDefault(),this.touch=e.changedTouches[0],this.tapped?(clearTimeout(this.tapped),this.tapped=null,this.onDoubleTap(e)):this.tapped=setTimeout(function(){return t.tapped=null},300)}},{key:"onTouchMove",value:function(e){e.preventDefault();var t=e.changedTouches[0];t.screenX>this.touch.screenX?(this.rightDown=!0,this.leftDown=!1):t.screenX<this.touch.screenX&&(this.leftDown=!0,this.rightDown=!1),t.screenY>this.touch.screenY?(this.downDown=!0,this.upDown=!1):t.screenY<this.touch.screenY&&(this.upDown=!0,this.downDown=!1)}},{key:"onTouchEnd",value:function(e){e.preventDefault(),this.rightDown=!1,this.leftDown=!1,this.upDown=!1,this.downDown=!1}},{key:"onDoubleTap",value:function(e){this.togglePause()}},{key:"loadImages",value:function(){this.tileatlas.add("vase",{x:0,y:0,w:32,h:32})}},{key:"togglePause",value:function(){this.paused=!this.paused,this.paused?this.emit("paused"):this.emit("unpaused"),this.tick()}},{key:"pause",value:function(){this.paused=!0}},{key:"unpause",value:function(){this.paused=!1,this.tick()}},{key:"drawImage",value:function(e,t,n,i){var s=e.tiles.get(t);if(void 0===s)throw new Error("Tile not found for key: "+t);this.ctx.drawImage(e.img,s.x,s.y,s.w,s.h,n,i,s.w,s.h)}},{key:"collides",value:function(e,t){return!(e.y+e.height<t.y||e.y>t.y+t.height||e.x+e.width<t.x||e.x>t.x+t.width)}},{key:"checkCollision",value:function(e,t,n){this.collides(e,t)&&n(e,t)}},{key:"elasticCollision",value:function(e,t){return{x1:(e.velocity.x*(e.mass-t.mass)+2*t.mass*t.velocity.x)/(e.mass+t.mass),y1:(e.velocity.y*(e.mass-t.mass)+2*t.mass*t.velocity.y)/(e.mass+t.mass),x2:(t.velocity.x*(t.mass-e.mass)+2*e.mass*e.velocity.x)/(t.mass+e.mass),y2:(t.velocity.y*(t.mass-e.mass)+2*e.mass*e.velocity.y)/(t.mass+e.mass)}}},{key:"updateVase",value:function(){var e=5;this.leftDown?this.vase.x-=e:this.rightDown&&(this.vase.x+=e),this.upDown?this.vase.y-=e:this.downDown&&(this.vase.y+=e),this.vase.x<0?this.vase.x=this.width:this.vase.x>this.width&&(this.vase.x=0),this.vase.y<0?this.vase.y=this.height:this.vase.y>this.height&&(this.vase.y=0)}},{key:"update",value:function(){this.ctx.clearRect(0,0,this.width,this.height),this.updateVase(),this.drawImage(this.vase.tileset,this.vase.key,this.vase.x,this.vase.y)}},{key:"tick",value:function(){if(!this.paused){var e=(new Date).getTime(),t=e-this.time,n=1e3/this.fps;t>n&&(this.time=e-this.time%n,this.update()),window.requestAnimationFrame(this.tick.bind(this))}}}]),t}(p.default);t.default=y},function(e,t,n){"use strict";var i;!function(s,r,o){function a(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function u(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return v[e.which]?v[e.which]:y[e.which]?y[e.which]:String.fromCharCode(e.which).toLowerCase()}function c(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function l(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function h(e,t){var n,i,s,r=[];for(n=e,"+"===n?n=["+"]:(n=n.replace(/\+{2}/g,"+plus"),n=n.split("+")),s=0;s<n.length;++s)i=n[s],w[i]&&(i=w[i]),t&&"keypress"!=t&&m[i]&&(i=m[i],r.push("shift")),l(i)&&r.push(i);if(n=i,s=t,!s){if(!d){d={};for(var o in v)95<o&&112>o||v.hasOwnProperty(o)&&(d[v[o]]=o)}s=d[n]?"keydown":"keypress"}return"keypress"==s&&r.length&&(s="keydown"),{key:i,modifiers:r,action:s}}function f(e,t){return null!==e&&e!==r&&(e===t||f(e.parentNode,t))}function p(e){function t(e){e=e||{};var t,n=!1;for(t in y)e[t]?n=!0:y[t]=0;n||(g=!1)}function n(e,t,n,i,s,r){var o,a,u=[],c=n.type;if(!d._callbacks[e])return[];for("keyup"==c&&l(e)&&(t=[e]),o=0;o<d._callbacks[e].length;++o)if(a=d._callbacks[e][o],(i||!a.seq||y[a.seq]==a.level)&&c==a.action){var h;(h="keypress"==c&&!n.metaKey&&!n.ctrlKey)||(h=a.modifiers,h=t.sort().join(",")===h.sort().join(",")),h&&(h=i&&a.seq==i&&a.level==r,(!i&&a.combo==s||h)&&d._callbacks[e].splice(o,1),u.push(a))}return u}function i(e,t,n,i){d.stopCallback(t,t.target||t.srcElement,n,i)||!1!==e(t,n)||(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation?t.stopPropagation():t.cancelBubble=!0)}function s(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t=u(e);t&&("keyup"==e.type&&m===t?m=!1:d.handleKey(t,c(e),e))}function o(e,n,s,r){function o(n){return function(){g=n,++y[e],clearTimeout(v),v=setTimeout(t,1e3)}}function a(n){i(s,n,e),"keyup"!==r&&(m=u(n)),setTimeout(t,10)}for(var c=y[e]=0;c<n.length;++c){var l=c+1===n.length?a:o(r||h(n[c+1]).action);f(n[c],l,r,e,c)}}function f(e,t,i,s,r){d._directMap[e+":"+i]=t,e=e.replace(/\s+/g," ");var a=e.split(" ");1<a.length?o(e,a,t,i):(i=h(e,i),d._callbacks[i.key]=d._callbacks[i.key]||[],n(i.key,i.modifiers,{type:i.action},s,e,r),d._callbacks[i.key][s?"unshift":"push"]({callback:t,modifiers:i.modifiers,action:i.action,seq:s,level:r,combo:e}))}var d=this;if(e=e||r,!(d instanceof p))return new p(e);d.target=e,d._callbacks={},d._directMap={};var v,y={},m=!1,w=!1,g=!1;d._handleKey=function(e,s,r){var o,a=n(e,s,r);s={};var u=0,c=!1;for(o=0;o<a.length;++o)a[o].seq&&(u=Math.max(u,a[o].level));for(o=0;o<a.length;++o)a[o].seq?a[o].level==u&&(c=!0,s[a[o].seq]=1,i(a[o].callback,r,a[o].combo,a[o].seq)):c||i(a[o].callback,r,a[o].combo);a="keypress"==r.type&&w,r.type!=g||l(e)||a||t(s),w=c&&"keydown"==r.type},d._bindMultiple=function(e,t,n){for(var i=0;i<e.length;++i)f(e[i],t,n)},a(e,"keypress",s),a(e,"keydown",s),a(e,"keyup",s)}if(s){var d,v={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},y={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},m={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},w={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"};for(o=1;20>o;++o)v[111+o]="f"+o;for(o=0;9>=o;++o)v[o+96]=o;p.prototype.bind=function(e,t,n){return e=e instanceof Array?e:[e],this._bindMultiple.call(this,e,t,n),this},p.prototype.unbind=function(e,t){return this.bind.call(this,e,function(){},t)},p.prototype.trigger=function(e,t){return this._directMap[e+":"+t]&&this._directMap[e+":"+t]({},e),this},p.prototype.reset=function(){return this._callbacks={},this._directMap={},this},p.prototype.stopCallback=function(e,t){return!(-1<(" "+t.className+" ").indexOf(" mousetrap ")||f(t,this.target))&&("INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable)},p.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},p.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(v[t]=e[t]);d=null},p.init=function(){var e,t=p(r);for(e in t)"_"!==e.charAt(0)&&(p[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e))},p.init(),s.Mousetrap=p,"undefined"!=typeof e&&e.exports&&(e.exports=p),n(7)&&(i=function(){return p}.call(t,n,t,e),!(void 0!==i&&(e.exports=i)))}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},function(e,t){"use strict";function n(e,t){"function"!=typeof t&&(t=e),window.addEventListener("focus",t),window.addEventListener("blur",e),document.addEventListener("visibilitychange",function(){document.hidden?e():t()})}function i(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n}Object.defineProperty(t,"__esModule",{value:!0}),t.onHidden=n,t.createCanvas=i},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function s(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,s,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],o(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(r(n))for(a=Array.prototype.slice.call(arguments,1),c=n.slice(),s=c.length,u=0;u<s;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var s;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(s=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,s&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var s=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,s,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,s=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){s=a;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,n){e.exports=n(0)}]);